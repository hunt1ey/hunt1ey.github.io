---
layout: post
title: Android 客户端安全---客户端程序安全
date: 2018-03-08 19:33:10 +0300
description: You’ll find this post in your `_posts` directory. Go ahead and edit it and re-build the site to see your changes. # Add post description (optional)
img: mac.jpg # Add image post (optional)
tags: [pentest]
---

## 反编译保护检测

测试客户端安装程序，判断是否能反编译为源代码，是否存在代码混淆等保护措施。未作保护的java代码，可以轻易分析其运行逻辑，并针对代码中的缺陷对客户端或服务器端进行攻击。测试步骤：

- 使用反编译软件进行反编译，结果如下



- 测试结果

不安全。程序可以被反编译。

- 修复建议

使用第三方厂商进行加固，例如腾讯乐固、阿里云加固等。

## 二次打包检测

该测试项根据OWASP Mobile Security M10（缺乏二进制保护）定义制定，目的是排查此类安全问题。在程序包可以反编译的情况下，可以对反编译出来的smali文件进行修改，再对程序进行重新打包并进行签名。安卓软件市场众多，秩序混乱，用户很少从官网下载应用而大多数在第三方市场下载。黑客通过这种方法获得篡改后的程序，并且把篡改后的程序上传到第三方市场，用户一旦使用被篡改的程序会导致用户信息泄露或者被黑客劫持操作而导致金钱损失。


- 测试结果：
修改前：
 
修改后：
 


- 测试结果：


不安全。程序可以被修改后重新打包安装，能够正常使用。


- 修复建议：


使用第三方厂商进行加固，例如腾讯乐固、阿里云加固等。


## 安装包签名检测

Android App的应用必须经过签名才能在Android系统安装认证，而签名所用的证书是开发者自己颁发的，这样的证书所有者、发布者、有效期、国家、地区、组织的属性都可以伪造。有些企业为了提高Android App的可信任性签名证书是用权威CA中心颁发的。攻击者可能查看签名证书的属性，如果发现不是权威CA中心颁发的，就可能去伪造钓鱼App。
测试步骤：


1. 使用解压缩工具解压客户端，一般情况下META-INF目录下的CERT.RSA为对程序进行签名的证书，CERT.SF文件存储了客户端中各个文件的签名值。
2. 使用keytool工具的查看证书的信息。命令为：keytool -printcert -file 证书

- 测试结果：


安全。如图所示，是自建的签名证书。

## 本地DoS攻击检测（低风险）
DoS，即拒绝服务攻击，程序intent调用存在漏洞。黑客可以通过该漏洞，针对性地发布相关攻击程序，只要用户不小心安装带有攻击代码的程序（程序可能经过伪装），那么目标程序一启动就会立即报错并终止进程，程序退出。      
本地拒绝服务漏洞不仅可以导致安全防护等应用的防护功能被绕过或失效（如杀毒应用、安全卫士、防盗锁屏等），而且也可被竞争方应用利用来攻击，使得自己的应用崩溃，造成不同程度的经济利益损失。
漏洞详情链接：https://jaq.alibaba.com/blog.htm?id=55 
测试步骤：

检测程序暴露Activity，暴露的Activity若接受了Intent就有可能存在DoS漏洞。
 


- 测试结果：

不安全，从上图可以看出出主activity外还暴露了多个acivity，使得程序存在本地DoS漏洞。


- 修复建议：


建议对于非主activity的其他不必要的activity，不要导出，将exported属性设为false。 
若为核心的activity，可以在Intent.getXXXExtra()获取的数据时捕获异常。
异常包括：
1) 空指针异常；
2) 类型转换异常；
3) 数组越界访问异常；
4) 类未定义异常；
5) 其他异常；
## so文件静态反编译检测（中风险）
可以从程序包中获取.so文件，利用IDA进行.so文件的静态反编译，获得.so的汇编代码，没有进行加固处理的.so文件可以从汇编代码转换为可读性较强函数，方便分析内部原理，而进行加固处理的.so文件，由于做了加壳，加密等处理，导致代码可读性降低，分析难度加大。
测试步骤：
	获取目标程序的.so文件，使用IDA加载并转换为可读性较强的语言，如下图：
 


- 测试结果：


不安全。如上图所示，可以转化为可读性强的代码。


- 修复建议：


方案一： 采用O-LLVM进行NDK混淆，构建步骤：http://www.jianshu.com/p/0c23e0a886f4 
方案二：使用UPX加壳，步骤；http://www.cnblogs.com/Reverser/p/5778042.html 

